---
title: 配置数据库
categories:
  - 服务端开发
tags:
  - django
date: 2021-07-20 13:21:49
---

### 创建用户，并配置权限

```mysql
-- 创建数据库
create database database_name default charset=utf8mb4;
-- 创建用户
create user user_name identified by 'password'; 
-- 配置权限
grant all on database_name.* to 'user_name'@'%'; 
-- 刷新权限
flush privileges;
```

### 配置mysql

settings.py

```python
DATABASES = {
    'default': {  # 主机: 增删改
        'ENGINE': 'django.db.backends.mysql',
        'HOST': '192.168.103.210',  # 数据库主机
        'PORT': 3306,  # 数据库端口
        'USER': 'user_name',  # 数据库用户名
        'PASSWORD': 'password',  # 数据库用户密码
        'NAME': 'database_name'  # 数据库名字
    },
    'slave': {  # 从机: 查
        'ENGINE': 'django.db.backends.mysql',
        'HOST': '192.168.103.210',  # 数据库主机
        'PORT': 8306,  # 数据库端口
        'USER': 'user_name',  # 数据库用户名
        'PASSWORD': 'password',  # 数据库用户密码
        'NAME': 'database_name'  # 数据库名字
    }
}
```

init.py

```python
import pymysql
pymysql.install_as_MySQLdb()
```

### 数据库路由分发

```python
class MasterSlaveDBRouter(object):
    """数据库主从读写分离路由"""

    def db_for_read(self, model, **hints):
        """读数据库"""
        return "slave"

    def db_for_write(self, model, **hints):
        """写数据库"""
        return "default"

    def allow_relation(self, obj1, obj2, **hints):
        """是否运行关联操作"""
        return True
```

settings.py

```python
# 配置读写分离
DATABASE_ROUTERS = ['project.utils.db_router.MasterSlaveDBRouter']
```

### 配置mysql主从同步

[用docker快速搭建mysql，配置主从同步](https://blog.myard.cn/notes/78/)













